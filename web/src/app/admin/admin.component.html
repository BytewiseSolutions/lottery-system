<div class="admin-container">
  <div class="mobile-sidebar-overlay" [class.active]="isMobileSidebarOpen" (click)="closeMobileSidebar()"></div>
    
    <div class="admin-dashboard">
      <div class="sidebar" [class.mobile-open]="isMobileSidebarOpen">
        <app-admin-sidebar 
          [activeSection]="activeSection"
          [totalResults]="totalResults"
          [isConnected]="isConnected"
          [storageUsed]="storageUsed"
          [storageTotal]="storageTotal"
          [storagePercentage]="storagePercentage"
          [memoryUsage]="memoryUsage"
          [lastLogin]="lastLogin"
          (sectionChange)="onSectionChange($event); closeMobileSidebar()"
          (logoutClick)="onSidebarLogout()">
        </app-admin-sidebar>
      </div>

      <main class="main-content">

        <header class="top-bar">
          <div class="breadcrumb">
            <button class="mobile-sidebar-toggle" (click)="toggleMobileSidebar()">
              <i class="fas fa-bars"></i>
            </button>
            <a (click)="goHome()">Home</a>
            <i class="fas fa-chevron-right"></i>
            <span>{{ getPageTitle() }}</span>
          </div>
          
          <div class="top-bar-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input 
                type="text" 
                placeholder="Search..." 
                [(ngModel)]="searchQuery"
                (input)="onSearch()">
            </div>
            <button class="btn-icon" (click)="refreshData()" title="Refresh">
              <i class="fas fa-sync-alt" [class.spin]="isRefreshing"></i>
            </button>
          </div>
        </header>

        <!-- Dashboard Section -->
        @if (activeSection === 'dashboard') {
          <section class="dashboard-section">
            <div class="stats-grid">
              <div class="stat-card primary">
                <div class="stat-icon">
                  <i class="fas fa-ticket-alt"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ totalResults }}</h3>
                  <p>Total Results</p>
                  <span class="stat-trend positive">
                    <i class="fas fa-arrow-up"></i> {{ resultsGrowth }}% this month
                  </span>
                </div>
              </div>
              
              <div class="stat-card success">
                <div class="stat-icon">
                  <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ activeLotteries }}</h3>
                  <p>Active Lotteries</p>
                  <span class="stat-trend positive">
                    <i class="fas fa-arrow-up"></i> All running
                  </span>
                </div>
              </div>
              
              <div class="stat-card warning">
                <div class="stat-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ totalUsers }}</h3>
                  <p>Total Users</p>
                  <span class="stat-trend negative">
                    <i class="fas fa-arrow-down"></i> {{ usersGrowth }}% this week
                  </span>
                </div>
              </div>
              
              <div class="stat-card danger">
                <div class="stat-icon">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ pendingActions }}</h3>
                  <p>Pending Actions</p>
                  <span class="stat-trend neutral">
                    <i class="fas fa-minus"></i> Needs attention
                  </span>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h3>Upcoming Draws</h3>
              </div>
              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Lottery</th>
                      <th>Draw Date</th>
                      <th>Jackpot</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (draw of upcomingDraws; track draw.id) {
                      <tr>
                        <td>{{ draw.lottery }}</td>
                        <td>
                          <input 
                            type="datetime-local" 
                            [value]="formatDateTimeForInput(draw.drawDate)"
                            (change)="updateDrawTime(draw, $event)"
                            class="form-control form-control-sm"
                            style="min-width: 180px;">
                        </td>
                        <td>{{ draw.jackpot }}</td>
                        <td>
                          <span class="status-badge" [class]="draw.status">
                            {{ draw.status }}
                          </span>
                        </td>
                        <td>
                          <div class="table-actions">
                            <button class="btn-icon success" title="Announce Winners" (click)="announceWinner(draw)">
                              <i class="fas fa-trophy"></i>
                            </button>
                            <button class="btn-icon" title="Edit Draw Time" (click)="editDrawTime(draw)">
                              <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon danger" title="Delete Draw" (click)="deleteDraw(draw.id)">
                              <i class="fas fa-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </section>
        }

        <!-- Upload Results Section -->
        @if (activeSection === 'upload') {
          <section class="upload-section">
            <div class="upload-trigger">
              <div class="upload-info">
                <div class="info-icon">
                  <i class="fas fa-upload"></i>
                </div>
                <div class="info-text">
                  <h2>Upload New Result</h2>
                  <p>Add lottery results to the system</p>
                </div>
              </div>
              <button class="btn-primary" (click)="showUploadModal = true">
                <i class="fas fa-plus"></i> Upload Result
              </button>
            </div>
          </section>
        }

        <!-- Confirmation Modal -->
        @if (showConfirmModal && confirmModalData) {
          <div class="modal-overlay" (click)="cancelAction()">
            <div class="modal-content confirm-modal" (click)="$event.stopPropagation()">
              <div class="modal-header">
                <h3>{{ confirmModalData.title }}</h3>
                <button class="btn-close" (click)="cancelAction()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <div class="modal-body">
                <p>{{ confirmModalData.message }}</p>
              </div>
              
              <div class="modal-actions">
                <button class="btn btn-outline" (click)="cancelAction()">
                  Cancel
                </button>
                <button class="btn btn-danger" (click)="confirmAction()">
                  Confirm
                </button>
              </div>
            </div>
          </div>
        }

        <!-- Upload Success Modal -->
        @if (showSuccessModal && uploadSuccessData) {
          <div class="modal-overlay" (click)="showSuccessModal = false">
            <div class="modal-content success-modal large-modal" (click)="$event.stopPropagation()">
              <div class="modal-header success" [class.error]="uploadSuccessData.isError">
                <div class="success-icon" [class.error-icon]="uploadSuccessData.isError">
                  <i class="fas" [class.fa-check-circle]="!uploadSuccessData.isError" [class.fa-exclamation-circle]="uploadSuccessData.isError"></i>
                </div>
                <h3>{{ uploadSuccessData.isError ? 'Error' : (uploadSuccessData.message ? 'Success' : 'Result Uploaded Successfully!') }}</h3>
                <button class="btn-close" (click)="showSuccessModal = false">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <div class="modal-body">
                @if (uploadSuccessData.message && !uploadSuccessData.lottery) {
                  <p>{{ uploadSuccessData.message }}</p>
                } @else {
                  <div class="result-summary">
                    <div class="summary-grid">
                      <div class="summary-item">
                        <label>Lottery:</label>
                        <span>{{ uploadSuccessData.lottery }}</span>
                      </div>
                      <div class="summary-item">
                        <label>Draw Date:</label>
                        <span>{{ uploadSuccessData.drawDate | date:'medium' }}</span>
                      </div>
                      <div class="summary-item">
                        <label>Jackpot:</label>
                        <span>${{ uploadSuccessData.jackpot }}</span>
                      </div>
                      <div class="summary-item">
                        <label>Status:</label>
                        <span class="status-badge published">{{ uploadSuccessData.status || 'Published' }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="numbers-display">
                    <div class="winning-numbers-display">
                      <label>Winning Numbers:</label>
                      <div class="numbers-row horizontal">
                        @for (num of uploadSuccessData.winningNumbers; track $index) {
                          <span class="number-badge winning">{{ num }}</span>
                        }
                      </div>
                    </div>
                    
                    <div class="bonus-numbers-display">
                      <label>Bonus Numbers:</label>
                      <div class="numbers-row horizontal">
                        @for (num of uploadSuccessData.bonusNumbers; track $index) {
                          <span class="number-badge bonus">{{ num }}</span>
                        }
                      </div>
                    </div>
                  </div>

                  <div class="winners-summary">
                    <div class="winners-count">
                      <div class="count-display">
                        <span class="count">{{ uploadSuccessData.winners }}</span>
                        <span class="label">Winners Found</span>
                      </div>
                      @if (uploadSuccessData.totalEntries) {
                        <div class="entries-info">
                          <small>Out of {{ uploadSuccessData.totalEntries }} total entries</small>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
              
              <div class="modal-actions">
                <button class="btn btn-primary" (click)="showSuccessModal = false">
                  <i class="fas fa-check"></i> Continue
                </button>
              </div>
            </div>
          </div>
        }

        <!-- Upload Modal -->
        @if (showUploadModal) {
          <div class="modal-overlay" (click)="showUploadModal = false">
            <div class="modal-content upload-modal" (click)="$event.stopPropagation()">
              <div class="modal-header">
                <h3>Upload New Result</h3>
                <button class="btn-close" (click)="showUploadModal = false">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <form [formGroup]="uploadForm" (ngSubmit)="uploadResult()" class="modal-form">
                <div class="form-group">
                  <label for="lottery">Lottery Type</label>
                  <select id="lottery" formControlName="lottery" class="form-control select-field" required>
                    <option value="" disabled>Select lottery type</option>
                    <option value="Monday Lotto">Monday Lotto</option>
                    <option value="Wednesday Lotto">Wednesday Lotto</option>
                    <option value="Friday Lotto">Friday Lotto</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="drawDate">Draw Date</label>
                  <input 
                    type="datetime-local" 
                    id="drawDate"
                    formControlName="drawDate" 
                    class="form-control" 
                    required>
                </div>
                
                <div class="form-group">
                  <label for="jackpot">Jackpot (Millions)</label>
                  <input 
                    type="number" 
                    id="jackpot"
                    formControlName="jackpot" 
                    class="form-control" 
                    placeholder="15.50"
                    step="0.01"
                    required>
                </div>

                <div class="numbers-section">
                  <label>Winning Numbers (5 numbers required)</label>
                  <div class="numbers-grid">
                    @for (num of winningNumbers; track $index; let i = $index) {
                      <input 
                        type="number" 
                        [(ngModel)]="winningNumbers[i]" 
                        [ngModelOptions]="{standalone: true}"
                        class="number-ball" 
                        min="1" 
                        max="75"
                        (input)="validateNumber($event, i, 'winning')"
                        placeholder="{{ i + 1 }}"
                        required>
                    }
                  </div>
                  <div class="numbers-actions">
                    <button type="button" class="btn-secondary" (click)="clearNumbers()">
                      <i class="fas fa-refresh"></i> Clear All
                    </button>
                  </div>
                </div>

                <div class="numbers-section">
                  <label>Bonus Numbers (2 numbers required)</label>
                  <div class="numbers-grid bonus-grid">
                    @for (num of bonusNumbers; track $index; let i = $index) {
                      <input 
                        type="number" 
                        [(ngModel)]="bonusNumbers[i]" 
                        [ngModelOptions]="{standalone: true}"
                        class="number-ball bonus-ball" 
                        min="1" 
                        max="75"
                        (input)="validateNumber($event, i, 'bonus')"
                        placeholder="B{{ i + 1 }}"
                        required>
                    }
                  </div>
                  <div class="numbers-actions">
                    <button type="button" class="btn-secondary" (click)="clearBonusNumbers()">
                      <i class="fas fa-refresh"></i> Clear Bonus
                    </button>
                  </div>
                </div>

                <div class="modal-actions">
                  <div class="publish-option">
                    <input 
                      type="checkbox" 
                      id="publishNow" 
                      formControlName="publishNow"
                      class="checkbox">
                    <label for="publishNow">Publish immediately</label>
                  </div>
                  
                  <div class="action-buttons">
                    <button 
                      type="button" 
                      class="btn btn-outline"
                      (click)="saveDraft()"
                      [disabled]="uploadForm.invalid || isUploading">
                      <i class="fas fa-save"></i> Save Draft
                    </button>
                    <button 
                      type="submit" 
                      class="btn btn-primary"
                      [disabled]="uploadForm.invalid || isUploading">
                      @if (isUploading) {
                        <i class="fas fa-spinner fa-spin"></i> Uploading...
                      } @else {
                        <i class="fas fa-upload"></i> Upload Result
                      }
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        }

        <!-- Manage Results Section -->
        @if (activeSection === 'manage') {
          <section class="manage-section">
            @if (results.length === 0) {
              <div class="empty-results-state">
                <div class="empty-icon">
                  <i class="fas fa-inbox"></i>
                </div>
                <h3>No Results Yet</h3>
                <p>Start by uploading your first lottery result to see it here.</p>
                <button class="btn btn-primary" (click)="showUploadModal = true">
                  <i class="fas fa-plus"></i> Upload First Result
                </button>
              </div>
            } @else {
              <div class="card">
                <div class="card-header">
                  <h3><i class="fas fa-list"></i> Manage Results</h3>
                  <div class="header-actions">
                    <button class="btn btn-primary" (click)="showUploadModal = true">
                      <i class="fas fa-plus"></i> Upload Results
                    </button>
                    <button class="btn btn-outline" (click)="exportResults()">
                      <i class="fas fa-download"></i> Export
                    </button>
                  </div>
                </div>

                <div class="table-responsive">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th width="40">
                          <input type="checkbox" (change)="toggleSelectAll($event)">
                        </th>
                        <th>Lottery</th>
                        <th>Draw Date</th>
                        <th>Jackpot</th>
                        <th>Winners</th>
                        <th>Status</th>
                        <th>Last Updated</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (result of paginatedResults; track result.id) {
                        <tr [class.selected]="selectedResults.has(result.id)">
                          <td data-label="Select">
                            <input 
                              type="checkbox" 
                              [checked]="selectedResults.has(result.id)"
                              (change)="toggleSelectResult(result.id)">
                          </td>
                          <td data-label="Lottery">
                            <div class="lottery-info">
                              <i class="fas fa-ticket-alt"></i>
                              <span>{{ result.lottery }}</span>
                            </div>
                          </td>
                          <td data-label="Draw Date">{{ result.drawDate | date:'medium' }}</td>
                          <td data-label="Jackpot"><strong>{{ result.jackpot }}</strong></td>
                          <td data-label="Winners">
                            <span class="winners-count">{{ result.winners }}</span>
                          </td>
                          <td data-label="Status">
                            <span class="status-badge" [class]="result.status">
                              {{ result.status }}
                            </span>
                          </td>
                          <td data-label="Last Updated">
                            <span class="timestamp">{{ result.updatedAt | date:'short' }}</span>
                          </td>
                          <td data-label="Actions">
                            <div class="table-actions">
                              <button class="btn-icon" (click)="viewResult(result)" title="View">
                                <i class="fas fa-eye"></i>
                              </button>
                              <button class="btn-icon" (click)="editResult(result)" title="Edit">
                                <i class="fas fa-edit"></i>
                              </button>
                              <button 
                                class="btn-icon" 
                                (click)="toggleResultStatus(result)"
                                [title]="result.status === 'published' ? 'Unpublish' : 'Publish'">
                                <i 
                                  class="fas" 
                                  [class.fa-eye-slash]="result.status === 'published'"
                                  [class.fa-eye]="result.status !== 'published'">
                                </i>
                              </button>
                              <button 
                                class="btn-icon danger" 
                                (click)="deleteResult(result.id)"
                                title="Delete">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>

                @if (filteredResults.length > 0) {
                  <div class="table-footer">
                    <div class="table-info">
                      Showing {{ filteredResults.length }} of {{ totalResults }} results
                      @if (selectedResults.size > 0) {
                        <span class="selected-count">
                          ({{ selectedResults.size }} selected)
                        </span>
                      }
                    </div>
                    @if (selectedResults.size > 0) {
                      <div class="bulk-actions">
                        <select [(ngModel)]="bulkAction" class="form-control-sm">
                          <option value="">Bulk Actions</option>
                          <option value="publish">Publish Selected</option>
                          <option value="unpublish">Unpublish Selected</option>
                          <option value="delete">Delete Selected</option>
                          <option value="export">Export Selected</option>
                        </select>
                        <button 
                          class="btn btn-sm btn-primary"
                          (click)="applyBulkAction()"
                          [disabled]="!bulkAction">
                          Apply
                        </button>
                      </div>
                    }
                    <div class="pagination">
                      <button 
                        class="btn-icon" 
                        (click)="prevPage()"
                        [disabled]="currentPage === 1">
                        <i class="fas fa-chevron-left"></i>
                      </button>
                      <span class="page-info">
                        Page {{ currentPage }} of {{ totalPages }}
                      </span>
                      <button 
                        class="btn-icon" 
                        (click)="nextPage()"
                        [disabled]="currentPage === totalPages">
                        <i class="fas fa-chevron-right"></i>
                      </button>
                    </div>
                  </div>
                }
              </div>
            }
          </section>
        }

        <!-- Other sections (scheduled, analytics, users, logs, settings) -->
        @if (activeSection === 'scheduled') {
          <section class="scheduled-section">
            <div class="empty-scheduled-state">
              <div class="empty-icon">
                <i class="fas fa-clock"></i>
              </div>
              <h3>No Scheduled Uploads</h3>
              <p>Schedule lottery results to be automatically published at specific times.</p>
              <button class="btn btn-primary" (click)="showSection('upload')">
                <i class="fas fa-calendar-plus"></i> Schedule Upload
              </button>
            </div>
          </section>
        }

        @if (activeSection === 'analytics') {
          <section class="analytics-section">
            <div class="analytics-header">
              <div class="date-range">
                <button class="btn btn-sm" [class.active]="analyticsRange === '7d'" (click)="setAnalyticsRange('7d')">
                  Last 7 Days
                </button>
                <button class="btn btn-sm" [class.active]="analyticsRange === '30d'" (click)="setAnalyticsRange('30d')">
                  Last 30 Days
                </button>
                <button class="btn btn-sm" [class.active]="analyticsRange === '90d'" (click)="setAnalyticsRange('90d')">
                  Last 90 Days
                </button>
                <button class="btn btn-sm" [class.active]="analyticsRange === 'custom'" (click)="openDateRangePicker()">
                  Custom Range
                </button>
              </div>
            </div>

            <div class="analytics-stats-grid">
              <div class="stat-card primary">
                <div class="stat-icon">
                  <i class="fas fa-play"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ analyticsData.totalPlays | number }}</h3>
                  <p>Total Plays</p>
                </div>
              </div>
              
              <div class="stat-card success">
                <div class="stat-icon">
                  <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-content">
                  <h3>${{ analyticsData.totalRevenue | number }}</h3>
                  <p>Total Revenue</p>
                </div>
              </div>
              
              <div class="stat-card warning">
                <div class="stat-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ analyticsData.averagePlayersPerDraw | number }}</h3>
                  <p>Avg Players/Draw</p>
                </div>
              </div>
              
              <div class="stat-card info">
                <div class="stat-icon">
                  <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ analyticsData.winnerRate }}%</h3>
                  <p>Winner Rate</p>
                </div>
              </div>
            </div>

            <div class="analytics-grid">
              <!-- Charts and analytics content will be added here -->
            </div>
          </section>
        }

        @if (activeSection === 'users') {
          <section class="users-section">
            <div class="card">
              <div class="card-header">
                <h3><i class="fas fa-users"></i> User Management</h3>
                <div class="header-actions">
                  <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input 
                      type="text" 
                      placeholder="Search users..." 
                      [(ngModel)]="usersSearchQuery"
                      (input)="searchUsers()">
                  </div>
                  <button class="btn btn-primary" (click)="addUser()">
                    <i class="fas fa-user-plus"></i> Add User
                  </button>
                </div>
              </div>

              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Status</th>
                      <th>Verified</th>
                      <th>Joined</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (user of users; track user.id) {
                      <tr>
                        <td data-label="Name">
                          <div class="user-info">
                            <i class="fas fa-user-circle"></i>
                            <span>{{ user.full_name }}</span>
                          </div>
                        </td>
                        <td data-label="Email">{{ user.email }}</td>
                        <td data-label="Phone">{{ user.phone || 'N/A' }}</td>
                        <td data-label="Status">
                          <span class="status-badge" [class]="user.is_active ? 'active' : 'inactive'">
                            {{ user.is_active ? 'Active' : 'Inactive' }}
                          </span>
                        </td>
                        <td data-label="Verified">
                          <div class="verification-status">
                            <span class="verify-badge" [class]="user.email_verified ? 'verified' : 'unverified'">
                              <i class="fas" [class.fa-check]="user.email_verified" [class.fa-times]="!user.email_verified"></i>
                              Email
                            </span>
                            <span class="verify-badge" [class]="user.phone_verified ? 'verified' : 'unverified'">
                              <i class="fas" [class.fa-check]="user.phone_verified" [class.fa-times]="!user.phone_verified"></i>
                              Phone
                            </span>
                          </div>
                        </td>
                        <td data-label="Joined">
                          <span class="timestamp">{{ user.created_at | date:'short' }}</span>
                        </td>
                        <td data-label="Actions">
                          <div class="table-actions">
                            <button class="btn-icon" (click)="editUser(user)" title="Edit">
                              <i class="fas fa-edit"></i>
                            </button>
                            <button 
                              class="btn-icon danger" 
                              (click)="deleteUser(user.id)"
                              title="Delete">
                              <i class="fas fa-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>

              @if (users.length > 0) {
                <div class="table-footer">
                  <div class="table-info">
                    Showing {{ users.length }} of {{ totalUsersCount }} users
                  </div>
                  <div class="pagination">
                    <button 
                      class="btn-icon" 
                      (click)="prevUsersPage()"
                      [disabled]="usersCurrentPage === 1">
                      <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="page-info">
                      Page {{ usersCurrentPage }} of {{ usersTotalPages }}
                    </span>
                    <button 
                      class="btn-icon" 
                      (click)="nextUsersPage()"
                      [disabled]="usersCurrentPage === usersTotalPages">
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </div>
                </div>
              }
            </div>
          </section>
        }

        @if (activeSection === 'logs') {
          <section class="logs-section">
            <div class="empty-logs-state">
              <div class="empty-icon">
                <i class="fas fa-file-alt"></i>
              </div>
              <h3>Activity Logs</h3>
              <p>View system activity logs and audit trails for all admin actions.</p>
              <button class="btn btn-primary" disabled>
                <i class="fas fa-history"></i> Coming Soon
              </button>
            </div>
          </section>
        }

        @if (activeSection === 'settings') {
          <section class="settings-section">
            <div class="settings-tabs">
              <div class="tab-header">
                <button 
                  class="tab-btn" 
                  [class.active]="settingsTab === 'general'"
                  (click)="settingsTab = 'general'">
                  <i class="fas fa-cog"></i> General
                </button>
                <button 
                  class="tab-btn" 
                  [class.active]="settingsTab === 'api'"
                  (click)="settingsTab = 'api'">
                  <i class="fas fa-code"></i> API Settings
                </button>
                <button 
                  class="tab-btn" 
                  [class.active]="settingsTab === 'security'"
                  (click)="settingsTab = 'security'">
                  <i class="fas fa-shield-alt"></i> Security
                </button>
                <button 
                  class="tab-btn" 
                  [class.active]="settingsTab === 'notifications'"
                  (click)="settingsTab = 'notifications'">
                  <i class="fas fa-bell"></i> Notifications
                </button>
              </div>

              <div class="tab-content">
                @if (settingsTab === 'general') {
                  <div class="settings-form">
                    <div class="form-group">
                      <label>Site Name</label>
                      <input type="text" class="form-control" [(ngModel)]="siteSettings.name">
                    </div>
                    <div class="form-group">
                      <label>Default Timezone</label>
                      <select class="form-control" [(ngModel)]="siteSettings.timezone">
                        @for (tz of timezones; track tz) {
                          <option [value]="tz">{{ tz }}</option>
                        }
                      </select>
                    </div>
                    <div class="form-group">
                      <label>Results per page</label>
                      <input 
                        type="number" 
                        class="form-control" 
                        [(ngModel)]="siteSettings.resultsPerPage"
                        min="10" 
                        max="100">
                    </div>
                    <button class="btn btn-primary" (click)="saveSettings()">
                      Save Changes
                    </button>
                  </div>
                }

                @if (settingsTab === 'api') {
                  <div class="api-settings">
                    <div class="api-key-card">
                      <h4>API Keys</h4>
                      <div class="api-key-list">
                        @for (key of apiKeys; track key.id) {
                          <div class="api-key-item">
                            <div class="key-info">
                              <strong>{{ key.name }}</strong>
                              <code class="key-preview">{{ key.key.slice(0, 8) }}****</code>
                            </div>
                            <div class="key-actions">
                              <button class="btn-icon" (click)="copyApiKey(key.key)">
                                <i class="fas fa-copy"></i>
                              </button>
                              <button class="btn-icon" (click)="revokeApiKey(key.id)">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                        }
                      </div>
                      <button class="btn btn-primary" (click)="generateApiKey()">
                        <i class="fas fa-plus"></i> Generate New Key
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
          </section>
        }

        <!-- Edit Draw Modal -->
        @if (editingDraw) {
          <div class="modal-overlay" (click)="cancelEditDraw()">
            <div class="modal-content" (click)="$event.stopPropagation()">
              <div class="modal-header">
                <h3>Edit Draw</h3>
                <button class="btn-close" (click)="cancelEditDraw()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <form [formGroup]="editDrawForm" (ngSubmit)="saveDrawTime()" class="modal-form">
                <div class="form-group">
                  <label for="editLottery">Lottery Type</label>
                  <input type="text" id="editLottery" formControlName="lottery" class="form-control" readonly>
                </div>
                <div class="form-group">
                  <label for="editDrawDate">Draw Date & Time</label>
                  <input type="datetime-local" id="editDrawDate" formControlName="drawDate" class="form-control" required>
                </div>
                <div class="form-group">
                  <label for="editJackpot">Jackpot Amount</label>
                  <input type="number" id="editJackpot" formControlName="jackpot" class="form-control" step="0.01" required>
                </div>
                <div class="modal-actions">
                  <button type="button" class="btn btn-outline" (click)="cancelEditDraw()">Cancel</button>
                  <button type="submit" class="btn btn-primary" [disabled]="editDrawForm.invalid">Save Changes</button>
                </div>
              </form>
            </div>
          </div>
        }

        <!-- Edit User Modal -->
        @if (editingUser) {
          <div class="modal-overlay" (click)="cancelEditUser()">
            <div class="modal-content edit-user-modal" (click)="$event.stopPropagation()">
              <div class="modal-header">
                <h3>{{ editingUser?.id ? 'Edit User' : 'Add User' }}</h3>
                <button class="btn-close" (click)="cancelEditUser()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <form [formGroup]="userForm" (ngSubmit)="saveUser()" class="modal-form">
                <div class="form-group">
                  <label for="editUserName">Full Name</label>
                  <input type="text" id="editUserName" formControlName="full_name" class="form-control" required>
                </div>
                <div class="form-group">
                  <label for="editUserEmail">Email</label>
                  <input type="email" id="editUserEmail" formControlName="email" class="form-control" required>
                </div>
                <div class="form-group">
                  <label for="editUserPhone">Phone</label>
                  <input type="tel" id="editUserPhone" formControlName="phone" class="form-control">
                </div>
                <div class="form-group">
                  <div class="form-check">
                    <input type="checkbox" id="editUserActive" formControlName="is_active" class="form-check-input">
                    <label for="editUserActive" class="form-check-label">Active User</label>
                  </div>
                </div>
                <div class="modal-actions">
                  <button type="button" class="btn btn-outline" (click)="cancelEditUser()">Cancel</button>
                  <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid">Save Changes</button>
                </div>
              </form>
            </div>
          </div>
        }

        <!-- Announce Winner Modal -->
        @if (announcingWinner) {
          <div class="modal-overlay" (click)="cancelAnnounceWinner()">
            <div class="modal-content" (click)="$event.stopPropagation()">
              <div class="modal-header">
                <h3><i class="fas fa-trophy"></i> Announce Winners - {{ announcingWinner.lottery }}</h3>
                <button class="btn-close" (click)="cancelAnnounceWinner()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <form [formGroup]="announceWinnerForm" (ngSubmit)="submitWinners()" class="modal-form">
                <div class="form-info">
                  <p><strong>Draw Date:</strong> {{ announcingWinner.drawDate | date:'medium' }}</p>
                  <p><strong>Jackpot:</strong> {{ announcingWinner.jackpot }}</p>
                </div>

                <div class="numbers-section">
                  <label>Winning Numbers (5 numbers)</label>
                  <div class="numbers-grid">
                    @for (num of winnerNumbers; track $index; let i = $index) {
                      <input 
                        type="number" 
                        [(ngModel)]="winnerNumbers[i]" 
                        [ngModelOptions]="{standalone: true}"
                        class="number-ball" 
                        min="1" 
                        max="75"
                        (input)="validateWinnerNumber($event, i, 'winning')"
                        placeholder="{{ i + 1 }}">
                    }
                  </div>
                </div>

                <div class="numbers-section">
                  <label>Bonus Numbers (2 numbers)</label>
                  <div class="numbers-grid bonus-grid">
                    @for (num of winnerBonusNumbers; track $index; let i = $index) {
                      <input 
                        type="number" 
                        [(ngModel)]="winnerBonusNumbers[i]" 
                        [ngModelOptions]="{standalone: true}"
                        class="number-ball bonus-ball" 
                        min="1" 
                        max="75"
                        (input)="validateWinnerNumber($event, i, 'bonus')"
                        placeholder="B{{ i + 1 }}">
                    }
                  </div>
                </div>

                <div class="modal-actions">
                  <button type="button" class="btn btn-outline" (click)="cancelAnnounceWinner()">Cancel</button>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-trophy"></i> Announce Winners
                  </button>
                </div>
              </form>
            </div>
          </div>
        }
        <!-- Custom Date Range Modal -->
        @if (showCustomDateModal) {
          <div class="modal-overlay" (click)="cancelCustomDateRange()">
            <div class="modal-content custom-date-modal" (click)="$event.stopPropagation()">
              <div class="modal-header">
                <h3>Select Date Range</h3>
                <button class="btn-close" (click)="cancelCustomDateRange()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label for="dateFrom">From Date</label>
                  <input type="date" id="dateFrom" [(ngModel)]="customDateFrom" class="form-control" required>
                </div>
                <div class="form-group">
                  <label for="dateTo">To Date</label>
                  <input type="date" id="dateTo" [(ngModel)]="customDateTo" class="form-control" required>
                </div>
              </div>
              <div class="modal-actions">
                <button type="button" class="btn btn-outline" (click)="cancelCustomDateRange()">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="applyCustomDateRange()" [disabled]="!customDateFrom || !customDateTo">Apply Range</button>
              </div>
            </div>
          </div>
        }
        <!-- Edit Result Modal -->
        @if (editingResult) {
          <div class="modal-overlay" (click)="cancelEditResult()">
            <div class="modal-content edit-result-modal" (click)="$event.stopPropagation()">
              <div class="modal-header">
                <h3>Edit Result</h3>
                <button class="btn-close" (click)="cancelEditResult()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <form [formGroup]="editResultForm" (ngSubmit)="saveEditResult()" class="modal-form">
                <div class="form-group">
                  <label for="editLottery">Lottery Type</label>
                  <select id="editLottery" formControlName="lottery" class="form-control" required>
                    <option value="Monday Lotto">Monday Lotto</option>
                    <option value="Wednesday Lotto">Wednesday Lotto</option>
                    <option value="Friday Lotto">Friday Lotto</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="editDrawDate">Draw Date</label>
                  <input type="datetime-local" id="editDrawDate" formControlName="drawDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                  <label for="editJackpot">Jackpot (Millions)</label>
                  <input type="number" id="editJackpot" formControlName="jackpot" class="form-control" step="0.01" required>
                </div>

                <div class="numbers-section">
                  <label>Winning Numbers (5 numbers required)</label>
                  <div class="numbers-grid">
                    @for (num of editWinningNumbers; track $index; let i = $index) {
                      <input 
                        type="number" 
                        [(ngModel)]="editWinningNumbers[i]" 
                        [ngModelOptions]="{standalone: true}"
                        class="number-ball" 
                        min="1" 
                        max="75"
                        (input)="validateEditNumber($event, i, 'winning')"
                        placeholder="{{ i + 1 }}"
                        required>
                    }
                  </div>
                </div>

                <div class="numbers-section">
                  <label>Bonus Numbers (2 numbers required)</label>
                  <div class="numbers-grid bonus-grid">
                    @for (num of editBonusNumbers; track $index; let i = $index) {
                      <input 
                        type="number" 
                        [(ngModel)]="editBonusNumbers[i]" 
                        [ngModelOptions]="{standalone: true}"
                        class="number-ball bonus-ball" 
                        min="1" 
                        max="75"
                        (input)="validateEditNumber($event, i, 'bonus')"
                        placeholder="B{{ i + 1 }}"
                        required>
                    }
                  </div>
                </div>

                <div class="form-group">
                  <label for="editStatus">Status</label>
                  <select id="editStatus" formControlName="status" class="form-control">
                    <option value="published">Published</option>
                    <option value="draft">Draft</option>
                  </select>
                </div>

                <div class="modal-actions">
                  <button type="button" class="btn btn-outline" (click)="cancelEditResult()">Cancel</button>
                  <button type="submit" class="btn btn-primary" [disabled]="editResultForm.invalid">Save Changes</button>
                </div>
              </form>
            </div>
          </div>
        }